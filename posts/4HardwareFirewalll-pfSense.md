---
title: "Installation of Hardware-based Firewall"
subtitle: "Installing pfSense to add an additonal layer of protection to my home network"
# date: "2023-12-22"
date: "19-01-2022"
---

The motivation behind this project stemmed from my Cyber Security degree, when learning about protecting networks and infrastrucuture from cyber-attacks. Of course the average home network is not the same as an enterprise network, however gaining an understanding and setting up a starting point felt like a great project to undertake at the time.

I decided to use Proxmox again to virtualise my pfsense hardware router/firewall, because of the additonal benefits that virtualisation brings such as the ability to provision multiple services/applications under one machine, save on floor space & electricity bills as opposed to having a dedicated machine for each intended service, as this is not feasible at all.

I needed to purchase a whole new server, because my main homeserver will not have the remaining resources and also needs another Ethernet Nic for it to be considered for this project. Therefore, I did some research and decided to purchase some parts and build a second homeserver to act as a hardware firewall, and also be used for other projects in the future.

![images/5RPi-in-action-with-router.png](/images/5RPi-in-action-with-router.png)

PiRogue OS stands as a cornerstone of this project. This custom operating system developed and maintained by Defensive Lab Agency, comes with software packages preloaded onto the Raspberry Pi, provides remarkable versatility.

![images/5RPi3-top-down-view.png](/images/5RPi3-top-down-view.png)

The operating system employs tcpdump to capture network traffic into PCAP files and mitm-proxy to intercept and capture HTTPS traffic. Suricata detects malicious traffic based on rules, while nfstream inspects traffic to determine the application involved in each flow. For device analysis and forensics, adb interacts with Android devices, and libimobiledevice interacts with iOS devices. mvt conducts device forensic analysis, and frida instruments programs running on devices.

Data visualization is achieved through influxdb, storing data generated by nfstream and Suricata. Chronograph enables searching and exporting data stored in influxdb, and Grafana displays data on dashboards. Utilities include vim for editing files, git for versioning files, jq for manipulating JSON files, gnupg2 for signing, encrypting, and verifying files, and python3 for writing and executing Python programs.

![images/5RPi3-Grafana-overview-full.png](/images/5RPi3-Grafana-overview-full.png)

It should be noted that the operating system has most of these tools preconfigured, by the creators of the OS. They have also created a convenient CLI dashboard that can be viewed with the command ***pirogue-ctl status***.

![images/5pirogue-ctl-status.png](/images/5pirogue-ctl-status.png)

The tools I focused on during my project were the tools specifically for network intrusion detection and visualising the data collected. Tools like tcpdump and mitmdump, mitmproxy, Suricata, influxdb, Grafana. As you can see, a few tools have not been used or focused on in the project, because this OS can be used for mobile devices forensics, however this was not in the scope of the project.

In conclusion, while this project yielded valuable insights and demonstrated considerable promise, it ultimately encountered limitations attributable to the hardware constraints of the Raspberry Pi 3 Model B+.

Specifically, the Pi's limited RAM proved insufficient to comfortably handle the demands of the Pirogue OS toolkit. Operating all necessary tools simultaneously resulted in significantly slowed system performance and lengthy test execution times, rendering the platform impractical for real-world deployment.

Despite these challenges, the project yielded several positive takeaways. The preconfigured integrations with Grafana and InfluxDB proved highly intuitive and effective, showcasing the platform's potential for streamlined network monitoring and visualization. Furthermore, the user experience was demonstrably pleasant and user-friendly, even under resource constraints.

Based on these findings, I intend to revisit this project with a more robust hardware platform. The Raspberry Pi Model 4, with its increased RAM capacity, presents a compelling option for overcoming the limitations encountered in this initial iteration. I am confident that a more powerful platform will unlock the full potential of the Pirogue OS toolkit, enabling the creation of a truly viable and efficient network intrusion detection system.









 

<small>Sources:
- 1. https://pts-project.org/
- 2. https://www.raspberrypi.org/
- 3. https://www.portainer.io/



</small>
